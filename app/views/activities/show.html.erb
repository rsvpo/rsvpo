<script src="<%= ENV['CF'] %>fullcalendar.min.js"></script>
<link href="<%= ENV['CF'] %>fullcalendar.css" rel="stylesheet">

<div class="carousel-wrapper">
  <%= render 'carousel', activity: @activity %>
</div>

<div class="descriptions-wrapper text-center">
  <h3 class="activity-title">
    <%= @activity.title %> - <%= @activity.price %> (<%= @activity.duration %> minutes)
  </h3>
  <p class="activity-about">
    <%= @activity.about %>
  </p>
</div>

<% if @activity.active %>
  <div class="actions-wrapper text-center">
    <div class="like_btn_wrapper">
      <%= render 'like', activity: @activity %>
    </div>

    <span class="share_btn_wrapper">
      <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#share">
        Share
      </button>
    </span>

    <span class="rsvp-btn-wrapper">
      <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#rsvp">
        RSVP
      </button>
    </span>
  </div>

  <div class="calendar-wrapper container">
    <div id='calendar'></div>
  </div>
<% else %>
<% end %>

<div class="merchant container text-center">
  <% if @activity.merchant.logo? %>
    <span class="thumbnail">
      <%= cl_image_tag(@activity.merchant.logo.path, { size: '50x50', crop: :fill}) %>
    </span>
  <% end %>
  <h2><%= @activity.merchant.name %></h2>
</div>

<div class="comments-wrapper">
  <%= render 'comments', all_comments: @all_comments %>
</div>

<%= render 'sharemodal', activity: @activity %>
<%= render 'rsvpmodal', activity: @activity %>
<script>
  function reload_calendar(){
    var source = new Array();
    var new_rule_link = "<%= new_rule_path %>"
    $('#calendar').fullCalendar({
      dayClick: function(date, allDay, jsEvent, view) {
        document.location.href=new_rule_link + "?start_date=" + date;
      },
        header: {
            left: 'prev,today,next',
            center: 'title',
            right: 'month,agendaWeek,agendaDay'
        },
        selectable: true,
        selectHelper: true,
        editable: true,
        ignoreTimezone: false,
        select: this.select,
        eventClick: this.eventClick,
        eventSources: [
          {url: '<%= activity_path(@activity, format: :json) %>',
          error: function() {
            alert('there was an error while fetching events!');
          }}
        ],
        timeFormat: 'h:mmtt{ - h:mmtt} '
    });
  }
</script>
<script>
  $(document).ready(function() {
    reload_calendar();
  });
</script>